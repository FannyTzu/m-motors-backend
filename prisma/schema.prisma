generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

//ENUMS

enum Role {
  user
  admin
}

enum FolderStatus {
  active
  closed
  archived
}

enum OrderStatus {
  draft
  confirmed
  cancelled
}

enum VehiclesType {
  sale
  rental
}

enum VehiclesStatus {
  available
  reserved
  sold
}

enum PaymentStatus {
  paid
  failed
  pending
}

enum VehiclesTransmision {
  automatic
  manual
}

// TABLES


model User {
  id            Int      @id @default(autoincrement())
  password_hash String
  first_name    String?
  last_name     String?
  mail          String   @unique
  phone_number  String? 
  address       String?
  city          String?
  zip_code      String?  @db.VarChar(5)
  country       String?  @default("France")
  role          Role     @default(user)
  is_active     Boolean  @default(true)
  created_at    DateTime @default(now())

  folders        Folder[]
  refresh_tokens RefreshToken[]
}

model RefreshToken {
  id          Int      @id @default(autoincrement())
  token_hash  String
  user_id     Int
  user        User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  expires_at  DateTime
  created_at  DateTime @default(now())
}

model Folder {
  id         Int          @id @default(autoincrement())
  user_id    Int
  user       User         @relation(fields: [user_id], references: [id], onDelete: Cascade)
  status     FolderStatus @default(active)
  created_at DateTime     @default(now())
  orders     Order[]
}

model Vehicle {
  id         Int           @id @default(autoincrement())
  brand      String
  model      String
  year       Int
  energy     String
  kms        Int
  color      String
  place      Int
  door       Int
  type       VehiclesType
  image      String?
  price      Decimal       @db.Decimal(12, 2)
  transmission VehiclesTransmision?
  status     VehiclesStatus @default(available)
  created_at DateTime      @default(now())
  orders     Order[]
}

model Order {
  id           Int           @id @default(autoincrement())
  folder_id    Int
  folder       Folder        @relation(fields: [folder_id], references: [id], onDelete: Cascade)
  vehicles_id  Int
  vehicle      Vehicle       @relation(fields: [vehicles_id], references: [id], onDelete: Restrict)
  total_amount Decimal       @db.Decimal(12, 2)
  status       OrderStatus   @default(draft)
  created_at   DateTime      @default(now())
  options      CaseOptions[]
  payments     Payment[]
}

model Option {
  id          Int           @id @default(autoincrement())
  name        String
  price       Decimal       @db.Decimal(12, 2)
  description String?
  orders      CaseOptions[]
}

model CaseOptions {
  order_id       Int
  order          Order   @relation(fields: [order_id], references: [id], onDelete: Cascade)
  option_id      Int 
  option         Option  @relation(fields: [option_id], references: [id], onDelete: Cascade)
  price_at_order Decimal @db.Decimal(12, 2)

  @@id([order_id, option_id])
}

model Payment {
  id             Int           @id @default(autoincrement())
  order_id       Int 
  order          Order         @relation(fields: [order_id], references: [id], onDelete: Cascade)
  amount         Decimal       @db.Decimal(12, 2)
  status         PaymentStatus @default(pending)
  transaction_id String?
  paid_at        DateTime?
}